<!--
    Getting iframe size with Window.postMessage()
    @see: https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage
    @see: https://mdn.github.io/dom-examples/channel-messaging-basic/
    @see: https://stackoverflow.com/questions/25098021/securityerror-blocked-a-frame-with-origin-from-accessing-a-cross-origin-frame
-->

<!-- iframe.html -->

<script>
    (function( w, d ) {
        w.onload = function () {
            //Don't run unless in an iframe
            if (self == parent) {
                return;
            }

            const origin_target = '*'; // Any origin
            // const origin_target = 'https://bitsmodo.com'; // Specific origin

            // Send message to the parent on intervals
            // to adjust height dynamically
            setInterval(
                function () {
                    parent.postMessage(
                        {
                            event_id: 'document_size',
                            size: {
                                height: d.body.scrollHeight,
                            }
                        },
                        origin_target
                    );
                },
                200
            );
        };
    })( window, document );
</script>

<!-- parent.html -->

<script>
    (function( w, d ) {
        function get_message( e ) {
            const iframe = d.getElementById("outlet");
            const origin_allowed = '*'; // Any origin
            // const origin_allowed = 'https://bitsmodo.pl, https://bitsmodo.com'; // Specific origin(s)

            if ( origin_allowed !== '*' && ! origin_allowed.includes( e.origin ) ) {
                return false;
            }

            if ( iframe && 'document_size' === e.data.event_id ) {
                iframe.style.height = e.data.size.height + 'px';
            }
        }
        
        w.addEventListener( 'message', get_message );
    })( window, document );
</script>